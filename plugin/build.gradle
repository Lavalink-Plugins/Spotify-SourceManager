plugins {
    id "application"
    id "maven-publish"
    id "com.github.johnrengelman.shadow" version "7.1.1"
}

archivesBaseName = "lavasrc-plugin"

mainClassName = "org.springframework.boot.loader.JarLauncher"

dependencies {
    compileOnly("dev.arbjerg.lavalink:plugin-api:3.6.1")
    // runtimeOnly("com.github.freyacodes.lavalink:Lavalink-Server:3.6.0")
    implementation project(":main")
}

shadowJar {
    def implementation = project.configurations.implementation
    implementation.canBeResolved(true)
    configurations = [implementation]
    archiveClassifier.set("")
}

var isMavenDefined = findProperty("MAVEN_USERNAME") != null && findProperty("MAVEN_PASSWORD") != null

publishing {
    publications {
        maven(MavenPublication) {
            pom {
                from components.java
                artifactId archivesBaseName
            }
        }
    }
    if (isMavenDefined) {
        System.out.println("Publishing to Maven Repo")
        repositories {
            maven {
                name = "Reposilite"
                url = "https://maven.topi.wtf"
                credentials {
                    username = findProperty("MAVEN_USERNAME")
                    password = findProperty("MAVEN_PASSWORD")
                }
            }
        }
    }
}
